# AIPOPS

APIOPS is an awesome api visualization and automated testing tool built on top of OpenAPI specification with Python, Flask, MongoDB and a lot of love!

## Prerequisites
1. Python 3.7.x or higher
2. MongoDB
3. Enchant - A spelling library developed in C ([Enchant](https://abiword.github.io/enchant/))

## Initial Setup
Note: These instructions are for macOS and Linux. 

You may need to open multiple bash/command line/terminal windows to run all the commands listed below.

1. Install virtualenv if not installed:
    
        python3 -m pip install --user virtualenv

2. Set up a virtualenv:

        python3 -m venv --prompt mailsy .venv
        source ./.venv/bin/activate
        pip install -r requirements.txt

3. Set up the database:

        mongo

4. Start Flask server:
    
        python flask_api.py

    Open your browser and browse to [http://127.0.0.1:5000](http://127.0.0.1:5000). You will see a default homepage
   
## API Endpoints
1. **/api/swagger_parser** : This API  is use to parse a swagger specification and store in the mongo collection. It accepts POST request with the following body parameters:
 
    1. **file** _(form_data)_: File path needs to be parsed
    
    Sends back following variables:
    
    1. **success** (_Boolean_): Indicates if parsed successful.
    2. **status** (_String_): Status code. 200 for a successful response
    3. **api_ops_id** (_String_): Unique id generated for the input file. This id canbe used to retrieve all apiops related data
    4. **message** (_String_): An ok or failure message

2. **/api/param_functions** : This API handles extracting element and element scores with storing that info in mongo collection. It accepts POST request with following body parameters:

    1. **api_ops_id** _(String)_: api_ops_id that was generated from swagger_parser
    
    Sends back following variables:
    
    1. **success** (_Boolean_): Indicates if parsed successful.
    2. **status** (_String_): Status code. 200 for a successful response
    4. **message** (_String_): An ok or failure message

## Design Principal

Here're all the .py files and their functions - 

1. **swagger_parser.py** - This file consider swagger json as input, dereference the json using **jsonref**  python library and store the extracted data into following collections - 
   1. apiinfo - Information like openapi version, tags, base path, hosted server
   2. paths - All path related information, methods, description, apiops_description (which is generated by considering operationId, description and summary)
   3. requests - All requests level parameters
   4. responses - All response related parameters

2. **param_functions.py** - This file consider api_ops_id as input, fetch all the parsed details and store element wise information in the following collections - 
   1. scores - A score for each element is calculated based on occurrence and required
   2. elements - A list of elements and end points where that element have been used

3. **utils.py** - A utility library

4. **db_manager.py** - An interface between python and mongo

5. **flask_api.py** - Flask code to handle all the endpoints

6. **parser_test.py** - A sample test script to generate a random test case for a particular endpoint based on elements and their format.